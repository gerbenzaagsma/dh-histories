{{ define "main" }}
  {{/* Parse dates; fall back to old event_date if needed */}}
  {{ $start := or .Params.event_start .Params.event_date }}
  {{ $end   := .Params.event_end }}

  {{ $startT := cond $start ($start | time) nil }}
  {{ $endT   := cond $end   ($end   | time) nil }}

  {{/* Helpers for comparisons */}}
  {{ $sameDay   := and $startT $endT (eq ($startT | time.Format "2006-01-02") ($endT | time.Format "2006-01-02")) }}
  {{ $sameMonth := and $startT $endT (and (eq ($startT | time.Format "2006") ($endT | time.Format "2006")) (eq ($startT | time.Format "01") ($endT | time.Format "01"))) }}
  {{ $sameYear  := and $startT $endT (eq ($startT | time.Format "2006") ($endT | time.Format "2006")) }}

  <article>
    <h1>{{ .Title }}</h1>

    <p class="meta">
      {{ if and $startT $endT }}
        {{/* Range formatting */}}
        {{ if $sameDay }}
          ğŸ“… {{ $startT | time.Format "Mon, Jan 2, 2006" }}
        {{ else if $sameMonth }}
          ğŸ“… {{ $startT | time.Format "Jan 2" }}â€“{{ $endT | time.Format "2, 2006" }}
        {{ else if $sameYear }}
          ğŸ“… {{ $startT | time.Format "Jan 2" }} â€“ {{ $endT | time.Format "Jan 2, 2006" }}
        {{ else }}
          ğŸ“… {{ $startT | time.Format "Jan 2, 2006" }} â€“ {{ $endT | time.Format "Jan 2, 2006" }}
        {{ end }}
      {{ else if $startT }}
        ğŸ“… {{ $startT | time.Format "Mon, Jan 2, 2006" }}
      {{ else }}
        ğŸ“… {{ .Date | time.Format "Mon, Jan 2, 2006" }}
      {{ end }}

      {{ with .Params.location }} Â· ğŸ“ {{ . }}{{ end }}
    </p>

    <div class="post-content">
      {{ .Content }}
    </div>

    {{ with .Params.tags }}
      <p>Tags:
        {{ range $i, $t := . }}{{ if $i }}, {{ end }}
          <a href="{{ (site.GetPage (printf "/tags/%s" $t)).RelPermalink }}">{{ $t }}</a>
        {{ end }}
      </p>
    {{ end }}
  </article>
{{ end }}